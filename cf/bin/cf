#!/bin/sh

linkop="->"

while true
do
    case $1 in
    --mode) shift; args="$args mode=$1"; shift ;;
    --force) shift; linkop="->!"; shift ;;
    --) shift; break ;;
    -*) echo "bad option: $1"; exit 1 ;;
    *) break ;;
    esac
done

tmp=/tmp/tcf

header()
{
cat >$tmp <<EOF
control:
    actionsequence = ( $1 )
$1:
EOF
}

simpleop()
{
    header $1
    shift
    for f in $*
    do
	echo " $f $args" >>$tmp
    done
}

op=$1; shift
case $op in
copy)
    header $op
    echo " $1 dest=$2 $args" >>$tmp
    ;;

link)
    header $op
    echo " $2 $linkop $1 $args" >>$tmp
    ;;

disable|directories|files|tidy)
    simpleop $op $*
    ;;

*)
    echo "bad operation: $op"; exit 1
    ;;
esac

cfagent -f $tmp
